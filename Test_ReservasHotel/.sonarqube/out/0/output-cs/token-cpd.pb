ÿ
iD:\ESPE\SEXTO SEMESTRE\Pruebas Software\Parcial2\Programas\ReservasHotel\ReservasHotel\WeatherForecast.cs
	namespace 	
ReservasHotel
 
{ 
public 

class 
WeatherForecast  
{ 
public 
DateOnly 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
TemperatureC 
{  !
get" %
;% &
set' *
;* +
}, -
public		 
int		 
TemperatureF		 
=>		  "
$num		# %
+		& '
(		( )
int		) ,
)		, -
(		- .
TemperatureC		. :
/		; <
$num		= C
)		C D
;		D E
public 
string 
? 
Summary 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ²
aD:\ESPE\SEXTO SEMESTRE\Pruebas Software\Parcial2\Programas\ReservasHotel\ReservasHotel\Program.cs
	namespace 	
ReservasHotel
 
{ 
public 

static 
class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{		 	
	DotNetEnv

 
.

 
Env

 
.

 
Load

 
(

 
)

  
;

  !
var 
builder 
= 
WebApplication (
.( )
CreateBuilder) 6
(6 7
args7 ;
); <
;< =
builder 
. 
Services 
. 
AddControllers +
(+ ,
), -
;- .
builder 
. 
Services 
. #
AddEndpointsApiExplorer 4
(4 5
)5 6
;6 7
builder 
. 
Services 
. 
AddSwaggerGen *
(* +
)+ ,
;, -
var 
connectionString  
=! "
Environment# .
.. /"
GetEnvironmentVariable/ E
(E F
$strF Y
)Y Z
;Z [
if 
( 
string 
. 
IsNullOrEmpty $
($ %
connectionString% 5
)5 6
)6 7
{ 
throw 
new %
InvalidOperationException 3
(3 4
$str4 s
)s t
;t u
} 
builder 
. 
Services 
. 
AddDbContext )
<) *
AppDBContext* 6
>6 7
(7 8
options8 ?
=>@ B
options 
. 
UseSqlServer $
($ %
connectionString% 5
)5 6
)6 7
;7 8
var   
app   
=   
builder   
.   
Build   #
(  # $
)  $ %
;  % &
if## 
(## 
app## 
.## 
Environment## 
.##  
IsDevelopment##  -
(##- .
)##. /
)##/ 0
{$$ 
app%% 
.%% 

UseSwagger%% 
(%% 
)%%  
;%%  !
app&& 
.&& 
UseSwaggerUI&&  
(&&  !
)&&! "
;&&" #
}'' 
app)) 
.)) 
UseHttpsRedirection)) #
())# $
)))$ %
;))% &
app++ 
.++ 
UseAuthorization++  
(++  !
)++! "
;++" #
app.. 
... 
MapControllers.. 
(.. 
)..  
;..  !
app00 
.00 
Run00 
(00 
)00 
;00 
}11 	
}22 
}33 ¬þ
~D:\ESPE\SEXTO SEMESTRE\Pruebas Software\Parcial2\Programas\ReservasHotel\ReservasHotel\Controllers\ReservasHotel.Controller.cs
	namespace 	
ReservasHotel
 
. 
Controllers #
{ 
[ 
ApiController 
] 
[		 
Route		 

(		
 
$str		 
)		 
]		 
public

 

class

 
ClientesController

 #
:

$ %
ControllerBase

& 4
{ 
private 
readonly 
AppDBContext %
_appDBcontext& 3
;3 4
public 
ClientesController !
(! "
AppDBContext" .
appDBcontext/ ;
); <
{ 	
_appDBcontext 
= 
appDBcontext (
;( )
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
GetClientes) 4
(4 5
)5 6
{ 	
var 
clientes 
= 
await  
_appDBcontext! .
.. /
Clientes/ 7
.7 8
ToListAsync8 C
(C D
)D E
;E F
return 
Ok 
( 
clientes 
) 
;  
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ActionResult &
<& '
AppDBContext' 3
.3 4
Cliente4 ;
>; <
>< =

GetCliente> H
(H I
intI L
idM O
)O P
{ 	
var 
cliente 
= 
await 
_appDBcontext  -
.- .
Clientes. 6
.6 7
	FindAsync7 @
(@ A
idA C
)C D
;D E
if 
( 
cliente 
== 
null 
)  
return! '
NotFound( 0
(0 1
)1 2
;2 3
return 
cliente 
; 
}   	
["" 	
HttpPost""	 
]"" 
public## 
async## 
Task## 
<## 
ActionResult## &
<##& '
AppDBContext##' 3
.##3 4
Cliente##4 ;
>##; <
>##< =
PostCliente##> I
(##I J
AppDBContext##J V
.##V W
Cliente##W ^
cliente##_ f
)##f g
{$$ 	
_appDBcontext%% 
.%% 
Clientes%% "
.%%" #
Add%%# &
(%%& '
cliente%%' .
)%%. /
;%%/ 0
await&& 
_appDBcontext&& 
.&&  
SaveChangesAsync&&  0
(&&0 1
)&&1 2
;&&2 3
return'' 
Ok'' 
('' 
cliente'' 
)'' 
;'' 
}(( 	
[** 	
HttpPut**	 
(** 
$str** 
)** 
]** 
public++ 
async++ 
Task++ 
<++ 
IActionResult++ '
>++' (

PutCliente++) 3
(++3 4
int++4 7
id++8 :
,++: ;
AppDBContext++< H
.++H I
Cliente++I P
cliente++Q X
)++X Y
{,, 	
var.. 
clienteExistente..  
=..! "
await..# (
_appDBcontext..) 6
...6 7
Clientes..7 ?
...? @
	FindAsync..@ I
(..I J
id..J L
)..L M
;..M N
if// 
(// 
clienteExistente//  
==//! #
null//$ (
)//( )
return//* 0
NotFound//1 9
(//9 :
$str//: Q
)//Q R
;//R S
clienteExistente11 
.11 
nombre11 #
=11$ %
cliente11& -
.11- .
nombre11. 4
;114 5
clienteExistente22 
.22 
apellido22 %
=22& '
cliente22( /
.22/ 0
apellido220 8
;228 9
clienteExistente33 
.33 
telefono33 %
=33& '
cliente33( /
.33/ 0
telefono330 8
;338 9
await66 
_appDBcontext66 
.66  
SaveChangesAsync66  0
(660 1
)661 2
;662 3
return77 
Ok77 
(77 
clienteExistente77 &
)77& '
;77' (
}88 	
[;; 	

HttpDelete;;	 
(;; 
$str;; 
);; 
];; 
public<< 
async<< 
Task<< 
<<< 
IActionResult<< '
><<' (
DeleteCliente<<) 6
(<<6 7
int<<7 :
id<<; =
)<<= >
{== 	
var>> 
cliente>> 
=>> 
await>> 
_appDBcontext>>  -
.>>- .
Clientes>>. 6
.>>6 7
	FindAsync>>7 @
(>>@ A
id>>A C
)>>C D
;>>D E
if?? 
(?? 
cliente?? 
==?? 
null?? 
)??  
return??! '
NotFound??( 0
(??0 1
)??1 2
;??2 3
_appDBcontextAA 
.AA 
ClientesAA "
.AA" #
RemoveAA# )
(AA) *
clienteAA* 1
)AA1 2
;AA2 3
awaitBB 
_appDBcontextBB 
.BB  
SaveChangesAsyncBB  0
(BB0 1
)BB1 2
;BB2 3
returnCC 
OkCC 
(CC 
$"CC 
$strCC +
{CC+ ,
clienteCC, 3
.CC3 4
nombreCC4 :
+CC; <
clienteCC= D
.CCD E
apellidoCCE M
}CCM N
"CCN O
)CCO P
;CCP Q
}DD 	
}EE 
[II 
ApiControllerII 
]II 
[JJ 
RouteJJ 

(JJ
 
$strJJ 
)JJ 
]JJ 
publicKK 

classKK "
HabitacionesControllerKK '
:KK( )
ControllerBaseKK* 8
{LL 
privateMM 
readonlyMM 
AppDBContextMM %
_appDBcontextMM& 3
;MM3 4
publicOO "
HabitacionesControllerOO %
(OO% &
AppDBContextOO& 2
contextOO3 :
)OO: ;
{PP 	
_appDBcontextQQ 
=QQ 
contextQQ #
;QQ# $
}RR 	
[TT 	
HttpGetTT	 
]TT 
publicUU 
asyncUU 
TaskUU 
<UU 
IActionResultUU '
>UU' (
GetHabitacionesUU) 8
(UU8 9
)UU9 :
{VV 	
varWW 
habitacionesWW 
=WW 
awaitWW $
_appDBcontextWW% 2
.WW2 3
HabitacionesWW3 ?
.WW? @
ToListAsyncWW@ K
(WWK L
)WWL M
;WWM N
returnXX 
OkXX 
(XX 
habitacionesXX "
)XX" #
;XX# $
}YY 	
[[[ 	
HttpGet[[	 
([[ 
$str[[ 
)[[ 
][[ 
public\\ 
async\\ 
Task\\ 
<\\ 
ActionResult\\ &
<\\& '
AppDBContext\\' 3
.\\3 4

Habitacion\\4 >
>\\> ?
>\\? @
GetHbitacion\\A M
(\\M N
int\\N Q
id\\R T
)\\T U
{]] 	
var^^ 

habitacion^^ 
=^^ 
await^^ "
_appDBcontext^^# 0
.^^0 1
Habitaciones^^1 =
.^^= >
	FindAsync^^> G
(^^G H
id^^H J
)^^J K
;^^K L
if__ 
(__ 

habitacion__ 
==__ 
null__ "
)__" #
return__$ *
NotFound__+ 3
(__3 4
)__4 5
;__5 6
return`` 

habitacion`` 
;`` 
}aa 	
[cc 	
HttpPostcc	 
]cc 
publicdd 
asyncdd 
Taskdd 
<dd 
ActionResultdd &
<dd& '
AppDBContextdd' 3
.dd3 4

Habitaciondd4 >
>dd> ?
>dd? @
PostHabitacionddA O
(ddO P
AppDBContextddP \
.dd\ ]

Habitaciondd] g

habitacionddh r
)ddr s
{ee 	
ifff 
(ff 

habitacionff 
==ff 
nullff !
)ff! "
returnff# )

BadRequestff* 4
(ff4 5
)ff5 6
;ff6 7
ifgg 
(gg 

habitaciongg 
.gg 
PrecioPorNochegg )
<gg* +
$numgg, -
)gg- .
returngg/ 5

BadRequestgg6 @
(gg@ A
$strggA l
)ggl m
;ggm n
ifhh 
(hh 

habitacionhh 
.hh 
tipohh 
==hh  "
nullhh# '
)hh' (
returnhh) /

BadRequesthh0 :
(hh: ;
$strhh; d
)hhd e
;hhe f

habitacionii 
.ii 

Disponibleii !
=ii" #
trueii$ (
;ii( )
_appDBcontextkk 
.kk 
Habitacioneskk &
.kk& '
Addkk' *
(kk* +

habitacionkk+ 5
)kk5 6
;kk6 7
awaitll 
_appDBcontextll 
.ll  
SaveChangesAsyncll  0
(ll0 1
)ll1 2
;ll2 3
returnmm 
Okmm 
(mm 

habitacionmm  
)mm  !
;mm! "
}nn 	
[pp 	
HttpPutpp	 
(pp 
$strpp 
)pp 
]pp 
publicqq 
asyncqq 
Taskqq 
<qq 
IActionResultqq '
>qq' (
PutHabitacionqq) 6
(qq6 7
intqq7 :
idqq; =
,qq= >
AppDBContextqq? K
.qqK L

HabitacionqqL V

habitacionqqW a
)qqa b
{rr 	
iftt 
(tt 

habitaciontt 
==tt 
nulltt "
)tt" #
returntt$ *

BadRequesttt+ 5
(tt5 6
)tt6 7
;tt7 8
ifuu 
(uu 

habitacionuu 
.uu 
PrecioPorNocheuu )
<uu* +
$numuu, -
)uu- .
returnuu/ 5

BadRequestuu6 @
(uu@ A
$struuA l
)uul m
;uum n
ifvv 
(vv 

habitacionvv 
.vv 
tipovv 
==vv  "
nullvv# '
)vv' (
returnvv) /

BadRequestvv0 :
(vv: ;
$strvv; d
)vvd e
;vve f
varxx 
habitacionExistentexx #
=xx$ %
awaitxx& +
_appDBcontextxx, 9
.xx9 :
Habitacionesxx: F
.xxF G
	FindAsyncxxG P
(xxP Q
idxxQ S
)xxS T
;xxT U
ifyy 
(yy 
habitacionExistenteyy #
==yy$ &
nullyy' +
)yy+ ,
returnyy- 3
NotFoundyy4 <
(yy< =
$stryy= W
)yyW X
;yyX Y
habitacionExistente{{ 
.{{  
tipo{{  $
={{% &

habitacion{{' 1
.{{1 2
tipo{{2 6
;{{6 7
habitacionExistente|| 
.||  
PrecioPorNoche||  .
=||/ 0

habitacion||1 ;
.||; <
PrecioPorNoche||< J
;||J K
habitacionExistente}} 
.}}  

Disponible}}  *
=}}+ ,

habitacion}}- 7
.}}7 8

Disponible}}8 B
;}}B C
await
 
_appDBcontext
 
.
  
SaveChangesAsync
  0
(
0 1
)
1 2
;
2 3
return
 
Ok
 
(
 !
habitacionExistente
 )
)
) *
;
* +
}
 	
[
 	

HttpDelete
	 
(
 
$str
 
)
 
]
 
public
 
async
 
Task
 
<
 
IActionResult
 '
>
' (
DeleteHabitacion
) 9
(
9 :
int
: =
id
> @
)
@ A
{
 	
var
 

habitacion
 
=
 
await
 "
_appDBcontext
# 0
.
0 1
Habitaciones
1 =
.
= >
	FindAsync
> G
(
G H
id
H J
)
J K
;
K L
if
 
(
 

habitacion
 
==
 
null
 "
)
" #
return
$ *
NotFound
+ 3
(
3 4
)
4 5
;
5 6
_appDBcontext
 
.
 
Habitaciones
 &
.
& '
Remove
' -
(
- .

habitacion
. 8
)
8 9
;
9 :
await
 
_appDBcontext
 
.
  
SaveChangesAsync
  0
(
0 1
)
1 2
;
2 3
return
 
Ok
 
(
 
$"
 
$str
 .
{
. /

habitacion
/ 9
.
9 :
id
: <
}
< =
"
= >
)
> ?
;
? @
}
 	
}
 
[
 
ApiController
 
]
 
[
 
Route
 

(

 
$str
 
)
 
]
 
public
 

class
  
ReservasController
 #
:
$ %
ControllerBase
& 4
{
 
private
 
readonly
 
AppDBContext
 %
_appDBcontext
& 3
;
3 4
public
  
ReservasController
 !
(
! "
AppDBContext
" .
context
/ 6
)
6 7
{
 	
_appDBcontext
 
=
 
context
 #
;
# $
}
 	
[
 	
HttpGet
	 
]
 
public
 
async
 
Task
 
<
 
IActionResult
 '
>
' (
GetReservas
) 4
(
4 5
)
5 6
{
 	
var
   
reservas
   
=
   
await
    
_appDBcontext
  ! .
.
  . /
Reservas
  / 7
.
  7 8
ToListAsync
  8 C
(
  C D
)
  D E
;
  E F
return
¡¡ 
Ok
¡¡ 
(
¡¡ 
reservas
¡¡ 
)
¡¡ 
;
¡¡  
}
¢¢ 	
[
¤¤ 	
HttpGet
¤¤	 
(
¤¤ 
$str
¤¤ 
)
¤¤ 
]
¤¤ 
public
¥¥ 
async
¥¥ 
Task
¥¥ 
<
¥¥ 
ActionResult
¥¥ &
<
¥¥& '
AppDBContext
¥¥' 3
.
¥¥3 4
Reserva
¥¥4 ;
>
¥¥; <
>
¥¥< =

GetReserva
¥¥> H
(
¥¥H I
int
¥¥I L
id
¥¥M O
)
¥¥O P
{
¦¦ 	
var
§§ 
reserva
§§ 
=
§§ 
await
§§ 
_appDBcontext
§§  -
.
§§- .
Reservas
§§. 6
.
§§6 7
	FindAsync
§§7 @
(
§§@ A
id
§§A C
)
§§C D
;
§§D E
if
¨¨ 
(
¨¨ 
reserva
¨¨ 
==
¨¨ 
null
¨¨ 
)
¨¨  
return
¨¨! '
NotFound
¨¨( 0
(
¨¨0 1
)
¨¨1 2
;
¨¨2 3
return
©© 
reserva
©© 
;
©© 
}
ªª 	
[
¬¬ 	
HttpPost
¬¬	 
]
¬¬ 
public
­­ 
async
­­ 
Task
­­ 
<
­­ 
ActionResult
­­ &
<
­­& '
AppDBContext
­­' 3
.
­­3 4
Reserva
­­4 ;
>
­­; <
>
­­< =
PostReserva
­­> I
(
­­I J
AppDBContext
­­J V
.
­­V W
Reserva
­­W ^
reserva
­­_ f
)
­­f g
{
®® 	
if
¯¯ 
(
¯¯ 
reserva
¯¯ 
.
¯¯ 
fechaInicio
¯¯ #
==
¯¯$ &
default
¯¯' .
||
¯¯/ 1
reserva
¯¯2 9
.
¯¯9 :
fechaFin
¯¯: B
==
¯¯C E
default
¯¯F M
)
¯¯M N
return
°° 

BadRequest
°° !
(
°°! "
$str
°°" P
)
°°P Q
;
°°Q R
if
²² 
(
²² 
reserva
²² 
.
²² 
fechaFin
²²  
<=
²²! #
reserva
²²$ +
.
²²+ ,
fechaInicio
²², 7
)
²²7 8
return
³³ 

BadRequest
³³ !
(
³³! "
$str
³³" X
)
³³X Y
;
³³Y Z
var
µµ 
cliente
µµ 
=
µµ 
await
µµ 
_appDBcontext
µµ  -
.
µµ- .
Clientes
µµ. 6
.
µµ6 7
	FindAsync
µµ7 @
(
µµ@ A
reserva
µµA H
.
µµH I
	clienteId
µµI R
)
µµR S
;
µµS T
if
¶¶ 
(
¶¶ 
cliente
¶¶ 
==
¶¶ 
null
¶¶ 
)
¶¶  
return
·· 
NotFound
·· 
(
··  
$str
··  D
)
··D E
;
··E F
var
¹¹ 

habitacion
¹¹ 
=
¹¹ 
await
¹¹ "
_appDBcontext
¹¹# 0
.
¹¹0 1
Habitaciones
¹¹1 =
.
¹¹= >
	FindAsync
¹¹> G
(
¹¹G H
reserva
¹¹H O
.
¹¹O P
habitacionId
¹¹P \
)
¹¹\ ]
;
¹¹] ^
if
ºº 
(
ºº 

habitacion
ºº 
==
ºº 
null
ºº "
)
ºº" #
return
»» 
NotFound
»» 
(
»»  
$str
»»  D
)
»»D E
;
»»E F
if
½½ 
(
½½ 
!
½½ 

habitacion
½½ 
.
½½ 

Disponible
½½ &
)
½½& '
return
¾¾ 

BadRequest
¾¾ !
(
¾¾! "
$str
¾¾" O
)
¾¾O P
;
¾¾P Q
_appDBcontext
ÁÁ 
.
ÁÁ 
Reservas
ÁÁ "
.
ÁÁ" #
Add
ÁÁ# &
(
ÁÁ& '
reserva
ÁÁ' .
)
ÁÁ. /
;
ÁÁ/ 0

habitacion
ÂÂ 
.
ÂÂ 

Disponible
ÂÂ !
=
ÂÂ" #
false
ÂÂ$ )
;
ÂÂ) *
await
ÃÃ 
_appDBcontext
ÃÃ 
.
ÃÃ  
SaveChangesAsync
ÃÃ  0
(
ÃÃ0 1
)
ÃÃ1 2
;
ÃÃ2 3
return
ÄÄ 
Ok
ÄÄ 
(
ÄÄ 
reserva
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
[
ÈÈ 	
HttpPut
ÈÈ	 
(
ÈÈ 
$str
ÈÈ 
)
ÈÈ 
]
ÈÈ 
public
ÉÉ 
async
ÉÉ 
Task
ÉÉ 
<
ÉÉ 
IActionResult
ÉÉ '
>
ÉÉ' (

PutReserva
ÉÉ) 3
(
ÉÉ3 4
int
ÉÉ4 7
id
ÉÉ8 :
,
ÉÉ: ;
AppDBContext
ÉÉ< H
.
ÉÉH I
Reserva
ÉÉI P
reserva
ÉÉQ X
)
ÉÉX Y
{
ÊÊ 	
var
ÌÌ 
reservaExistente
ÌÌ  
=
ÌÌ! "
await
ÌÌ# (
_appDBcontext
ÌÌ) 6
.
ÌÌ6 7
Reservas
ÌÌ7 ?
.
ÌÌ? @
	FindAsync
ÌÌ@ I
(
ÌÌI J
id
ÌÌJ L
)
ÌÌL M
;
ÌÌM N
if
ÍÍ 
(
ÍÍ 
reservaExistente
ÍÍ  
==
ÍÍ! #
null
ÍÍ$ (
)
ÍÍ( )
return
ÍÍ* 0
NotFound
ÍÍ1 9
(
ÍÍ9 :
$str
ÍÍ: Q
)
ÍÍQ R
;
ÍÍR S
if
ÏÏ 
(
ÏÏ 
reserva
ÏÏ 
.
ÏÏ 
fechaInicio
ÏÏ #
==
ÏÏ$ &
default
ÏÏ' .
||
ÏÏ/ 1
reserva
ÏÏ2 9
.
ÏÏ9 :
fechaFin
ÏÏ: B
==
ÏÏC E
default
ÏÏF M
)
ÏÏM N
return
ÐÐ 

BadRequest
ÐÐ !
(
ÐÐ! "
$str
ÐÐ" P
)
ÐÐP Q
;
ÐÐQ R
if
ÒÒ 
(
ÒÒ 
reserva
ÒÒ 
.
ÒÒ 
fechaFin
ÒÒ  
<=
ÒÒ! #
reserva
ÒÒ$ +
.
ÒÒ+ ,
fechaInicio
ÒÒ, 7
)
ÒÒ7 8
return
ÓÓ 

BadRequest
ÓÓ !
(
ÓÓ! "
$str
ÓÓ" X
)
ÓÓX Y
;
ÓÓY Z
if
ÕÕ 
(
ÕÕ 
reserva
ÕÕ 
.
ÕÕ 
precioTotal
ÕÕ #
<
ÕÕ$ %
$num
ÕÕ& '
)
ÕÕ' (
return
ÖÖ 

BadRequest
ÖÖ !
(
ÖÖ! "
$str
ÖÖ" J
)
ÖÖJ K
;
ÖÖK L
var
ØØ 
cliente
ØØ 
=
ØØ 
await
ØØ 
_appDBcontext
ØØ  -
.
ØØ- .
Clientes
ØØ. 6
.
ØØ6 7
	FindAsync
ØØ7 @
(
ØØ@ A
reserva
ØØA H
.
ØØH I
	clienteId
ØØI R
)
ØØR S
;
ØØS T
if
ÙÙ 
(
ÙÙ 
cliente
ÙÙ 
==
ÙÙ 
null
ÙÙ 
)
ÙÙ  
return
ÚÚ 
NotFound
ÚÚ 
(
ÚÚ  
$str
ÚÚ  D
)
ÚÚD E
;
ÚÚE F
var
ÜÜ 

habitacion
ÜÜ 
=
ÜÜ 
await
ÜÜ "
_appDBcontext
ÜÜ# 0
.
ÜÜ0 1
Habitaciones
ÜÜ1 =
.
ÜÜ= >
	FindAsync
ÜÜ> G
(
ÜÜG H
reserva
ÜÜH O
.
ÜÜO P
habitacionId
ÜÜP \
)
ÜÜ\ ]
;
ÜÜ] ^
if
ÝÝ 
(
ÝÝ 

habitacion
ÝÝ 
==
ÝÝ 
null
ÝÝ "
)
ÝÝ" #
return
ÞÞ 
NotFound
ÞÞ 
(
ÞÞ  
$str
ÞÞ  D
)
ÞÞD E
;
ÞÞE F
reservaExistente
áá 
.
áá 
fechaFin
áá %
=
áá& '
reserva
áá( /
.
áá/ 0
fechaFin
áá0 8
;
áá8 9
reservaExistente
ââ 
.
ââ 
fechaInicio
ââ (
=
ââ) *
reserva
ââ+ 2
.
ââ2 3
fechaInicio
ââ3 >
;
ââ> ?
reservaExistente
ãã 
.
ãã 
	clienteId
ãã &
=
ãã' (
reserva
ãã) 0
.
ãã0 1
	clienteId
ãã1 :
;
ãã: ;
reservaExistente
ää 
.
ää 
habitacionId
ää )
=
ää* +
reserva
ää, 3
.
ää3 4
habitacionId
ää4 @
;
ää@ A
reservaExistente
åå 
.
åå 
precioTotal
åå (
=
åå) *
reserva
åå+ 2
.
åå2 3
precioTotal
åå3 >
;
åå> ?
await
èè 
_appDBcontext
èè 
.
èè  
SaveChangesAsync
èè  0
(
èè0 1
)
èè1 2
;
èè2 3
return
éé 
Ok
éé 
(
éé 
reservaExistente
éé &
)
éé& '
;
éé' (
}
êê 	
[
íí 	

HttpDelete
íí	 
(
íí 
$str
íí 
)
íí 
]
íí 
public
îî 
async
îî 
Task
îî 
<
îî 
IActionResult
îî '
>
îî' (
DeleteReserva
îî) 6
(
îî6 7
int
îî7 :
id
îî; =
)
îî= >
{
ïï 	
var
ðð 
reserva
ðð 
=
ðð 
await
ðð 
_appDBcontext
ðð  -
.
ðð- .
Reservas
ðð. 6
.
ðð6 7
	FindAsync
ðð7 @
(
ðð@ A
id
ððA C
)
ððC D
;
ððD E
if
ññ 
(
ññ 
reserva
ññ 
==
ññ 
null
ññ 
)
ññ  
return
ññ! '
NotFound
ññ( 0
(
ññ0 1
)
ññ1 2
;
ññ2 3
_appDBcontext
óó 
.
óó 
Reservas
óó "
.
óó" #
Remove
óó# )
(
óó) *
reserva
óó* 1
)
óó1 2
;
óó2 3
await
ôô 
_appDBcontext
ôô 
.
ôô  
SaveChangesAsync
ôô  0
(
ôô0 1
)
ôô1 2
;
ôô2 3
return
õõ 
Ok
õõ 
(
õõ 
$"
õõ 
$str
õõ +
{
õõ+ ,
reserva
õõ, 3
.
õõ3 4
id
õõ4 6
}
õõ6 7
"
õõ7 8
)
õõ8 9
;
õõ9 :
}
öö 	
}
÷÷ 
[
ùù 
ApiController
ùù 
]
ùù 
[
úú 
Route
úú 

(
úú
 
$str
úú 
)
úú 
]
úú 
public
ûû 

class
ûû ,
ServiciosAdicionalesController
ûû /
:
ûû0 1
ControllerBase
ûû2 @
{
üü 
private
ýý 
readonly
ýý 
AppDBContext
ýý %
_appDBcontext
ýý& 3
;
ýý3 4
public
ÿÿ ,
ServiciosAdicionalesController
ÿÿ -
(
ÿÿ- .
AppDBContext
ÿÿ. :
context
ÿÿ; B
)
ÿÿB C
{
 	
_appDBcontext
 
=
 
context
 #
;
# $
}
 	
[
 	
HttpGet
	 
]
 
public
 
async
 
Task
 
<
 
IActionResult
 '
>
' (
GetServicios
) 5
(
5 6
)
6 7
{
 	
var
 
	servicios
 
=
 
await
 !
_appDBcontext
" /
.
/ 0"
ServiciosAdicionales
0 D
.
D E
ToListAsync
E P
(
P Q
)
Q R
;
R S
return
 
Ok
 
(
 
	servicios
 
)
  
;
  !
}
 	
[
 	
HttpGet
	 
(
 
$str
 
)
 
]
 
public
 
async
 
Task
 
<
 
ActionResult
 &
<
& '
AppDBContext
' 3
.
3 4
ServicioAdicional
4 E
>
E F
>
F G
GetServicio
H S
(
S T
int
T W
id
X Z
)
Z [
{
 	
var
 
servicio
 
=
 
await
  
_appDBcontext
! .
.
. /"
ServiciosAdicionales
/ C
.
C D
	FindAsync
D M
(
M N
id
N P
)
P Q
;
Q R
if
 
(
 
servicio
 
==
 
null
  
)
  !
return
" (
NotFound
) 1
(
1 2
)
2 3
;
3 4
return
 
servicio
 
;
 
}
 	
[
 	
HttpPost
	 
]
 
public
 
async
 
Task
 
<
 
ActionResult
 &
<
& '
AppDBContext
' 3
.
3 4
ServicioAdicional
4 E
>
E F
>
F G
PostServicio
H T
(
T U
AppDBContext
U a
.
a b
ServicioAdicional
b s
servicio
t |
)
| }
{
 	
var
 
reserva
 
=
 
await
 
_appDBcontext
  -
.
- .
Reservas
. 6
.
6 7
	FindAsync
7 @
(
@ A
servicio
A I
.
I J
	idReserva
J S
)
S T
;
T U
if
 
(
 
reserva
 
==
 
null
 
)
  
return
 
NotFound
 
(
  
$str
  D
)
D E
;
E F
_appDBcontext
 
.
 "
ServiciosAdicionales
 .
.
. /
Add
/ 2
(
2 3
servicio
3 ;
)
; <
;
< =
await
 
_appDBcontext
 
.
  
SaveChangesAsync
  0
(
0 1
)
1 2
;
2 3
return
 
Ok
 
(
 
servicio
 
)
 
;
  
}
 	
[
   	
HttpPut
  	 
(
   
$str
   
)
   
]
   
public
¡¡ 
async
¡¡ 
Task
¡¡ 
<
¡¡ 
IActionResult
¡¡ '
>
¡¡' (
PutServicio
¡¡) 4
(
¡¡4 5
int
¡¡5 8
id
¡¡9 ;
,
¡¡; <
AppDBContext
¡¡= I
.
¡¡I J
ServicioAdicional
¡¡J [
servicio
¡¡\ d
)
¡¡d e
{
¢¢ 	
var
¤¤ 
servicioExistente
¤¤ !
=
¤¤" #
await
¤¤$ )
_appDBcontext
¤¤* 7
.
¤¤7 8"
ServiciosAdicionales
¤¤8 L
.
¤¤L M
	FindAsync
¤¤M V
(
¤¤V W
id
¤¤W Y
)
¤¤Y Z
;
¤¤Z [
if
¥¥ 
(
¥¥ 
servicioExistente
¥¥ !
==
¥¥" $
null
¥¥% )
)
¥¥) *
return
¥¥+ 1
NotFound
¥¥2 :
(
¥¥: ;
$str
¥¥; S
)
¥¥S T
;
¥¥T U
var
§§ 
reserva
§§ 
=
§§ 
await
§§ 
_appDBcontext
§§  -
.
§§- .
Reservas
§§. 6
.
§§6 7
	FindAsync
§§7 @
(
§§@ A
servicio
§§A I
.
§§I J
	idReserva
§§J S
)
§§S T
;
§§T U
if
¨¨ 
(
¨¨ 
reserva
¨¨ 
==
¨¨ 
null
¨¨ 
)
¨¨  
return
©© 
NotFound
©© 
(
©©  
$str
©©  D
)
©©D E
;
©©E F
servicioExistente
«« 
.
«« 
descripcion
«« )
=
««* +
servicio
««, 4
.
««4 5
descripcion
««5 @
;
««@ A
servicioExistente
¬¬ 
.
¬¬ 
costo
¬¬ #
=
¬¬$ %
servicio
¬¬& .
.
¬¬. /
costo
¬¬/ 4
;
¬¬4 5
servicioExistente
­­ 
.
­­ 
	idReserva
­­ '
=
­­( )
servicio
­­* 2
.
­­2 3
	idReserva
­­3 <
;
­­< =
await
°° 
_appDBcontext
°° 
.
°°  
SaveChangesAsync
°°  0
(
°°0 1
)
°°1 2
;
°°2 3
return
±± 
Ok
±± 
(
±± 
servicioExistente
±± '
)
±±' (
;
±±( )
}
²² 	
[
µµ 	

HttpDelete
µµ	 
(
µµ 
$str
µµ 
)
µµ 
]
µµ 
public
¶¶ 
async
¶¶ 
Task
¶¶ 
<
¶¶ 
IActionResult
¶¶ '
>
¶¶' (
DeleteServicio
¶¶) 7
(
¶¶7 8
int
¶¶8 ;
id
¶¶< >
)
¶¶> ?
{
·· 	
var
¸¸ 
servicio
¸¸ 
=
¸¸ 
await
¸¸  
_appDBcontext
¸¸! .
.
¸¸. /"
ServiciosAdicionales
¸¸/ C
.
¸¸C D
	FindAsync
¸¸D M
(
¸¸M N
id
¸¸N P
)
¸¸P Q
;
¸¸Q R
if
¹¹ 
(
¹¹ 
servicio
¹¹ 
==
¹¹ 
null
¹¹  
)
¹¹  !
return
¹¹" (
NotFound
¹¹) 1
(
¹¹1 2
)
¹¹2 3
;
¹¹3 4
_appDBcontext
»» 
.
»» "
ServiciosAdicionales
»» .
.
»». /
Remove
»»/ 5
(
»»5 6
servicio
»»6 >
)
»»> ?
;
»»? @
await
¼¼ 
_appDBcontext
¼¼ 
.
¼¼  
SaveChangesAsync
¼¼  0
(
¼¼0 1
)
¼¼1 2
;
¼¼2 3
return
½½ 
Ok
½½ 
(
½½ 
$"
½½ 
$str
½½ ,
{
½½, -
servicio
½½- 5
.
½½5 6
id
½½6 8
}
½½8 9
"
½½9 :
)
½½: ;
;
½½; <
}
¾¾ 	
}
ÀÀ 
}ÁÁ Å/
fD:\ESPE\SEXTO SEMESTRE\Pruebas Software\Parcial2\Programas\ReservasHotel\ReservasHotel\AppDBContext.cs
	namespace 	
ReservasHotel
 
{ 
public 

class 
AppDBContext 
: 
	DbContext  )
{		 
public

 
AppDBContext

 
(

 
DbContextOptions

 ,
<

, -
AppDBContext

- 9
>

9 :
options

; B
)

B C
:

D E
base

F J
(

J K
options

K R
)

R S
{

T U
}

V W
public 
DbSet 
< 
Cliente 
> 
Clientes &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
DbSet 
< 

Habitacion 
>  
Habitaciones! -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
public 
DbSet 
< 
Reserva 
> 
Reservas &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
DbSet 
< 
ServicioAdicional &
>& ' 
ServiciosAdicionales( <
{= >
get? B
;B C
setD G
;G H
}I J
public 
class 
Cliente 
{ 	
public 
int 
? 
id 
{ 
get  
;  !
set" %
;% &
}' (
public 
required 
string "
nombre# )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
required 
string "
apellido# +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
string 
? 
telefono #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
ICollection 
< 
Reserva &
>& '
?' (
reservas) 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
} 	
public 
class 

Habitacion 
{   	
public!! 
int!! 
?!! 
id!! 
{!! 
get!!  
;!!  !
set!!" %
;!!% &
}!!' (
public## 
required## 
string## "
tipo### '
{##( )
get##* -
;##- .
set##/ 2
;##2 3
}##4 5
[%% 
Column%% 
(%% 
TypeName%% 
=%% 
$str%% .
)%%. /
]%%/ 0
public&& 
required&& 
decimal&& #
PrecioPorNoche&&$ 2
{&&3 4
get&&5 8
;&&8 9
set&&: =
;&&= >
}&&? @
public(( 
required(( 
bool((  

Disponible((! +
{((, -
get((. 1
;((1 2
set((3 6
;((6 7
}((8 9
public++ 
ICollection++ 
<++ 
Reserva++ &
>++& '
?++' (
reservas++) 1
{++2 3
get++4 7
;++7 8
set++9 <
;++< =
}++> ?
},, 	
public.. 
class.. 
Reserva.. 
{// 	
public00 
int00 
?00 
id00 
{00 
get00  
;00  !
set00" %
;00% &
}00' (
public22 
required22 
DateTime22 $
fechaInicio22% 0
{221 2
get223 6
;226 7
set228 ;
;22; <
}22= >
public44 
required44 
DateTime44 $
fechaFin44% -
{44. /
get440 3
;443 4
set445 8
;448 9
}44: ;
public66 
required66 
int66 
	clienteId66  )
{66* +
get66, /
;66/ 0
set661 4
;664 5
}666 7
public88 
required88 
int88 
habitacionId88  ,
{88- .
get88/ 2
;882 3
set884 7
;887 8
}889 :
[:: 
Column:: 
(:: 
TypeName:: 
=:: 
$str:: .
)::. /
]::/ 0
public;; 
required;; 
decimal;; #
precioTotal;;$ /
{;;0 1
get;;2 5
;;;5 6
set;;7 :
;;;: ;
};;< =
public== 
ICollection== 
<== 
ServicioAdicional== 0
>==0 1
?==1 2 
serviciosAdicionales==3 G
{==H I
get==J M
;==M N
set==O R
;==R S
}==T U
}>> 	
publicAA 
classAA 
ServicioAdicionalAA &
{BB 	
publicCC 
intCC 
?CC 
idCC 
{CC 
getCC  
;CC  !
setCC" %
;CC% &
}CC' (
publicEE 
requiredEE 
stringEE "
descripcionEE# .
{EE/ 0
getEE1 4
;EE4 5
setEE6 9
;EE9 :
}EE; <
[GG 
ColumnGG 
(GG 
TypeNameGG 
=GG 
$strGG .
)GG. /
]GG/ 0
publicHH 
requiredHH 
decimalHH #
costoHH$ )
{HH* +
getHH, /
;HH/ 0
setHH1 4
;HH4 5
}HH6 7
publicJJ 
requiredJJ 
intJJ 
	idReservaJJ  )
{JJ* +
getJJ, /
;JJ/ 0
setJJ1 4
;JJ4 5
}JJ6 7
}KK 	
}NN 
}OO 